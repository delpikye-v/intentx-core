"use strict";let e=0;function t(t){return Symbol(null!=t?t:"scope-"+ ++e)}const n={high:new Set,normal:new Set,low:new Set};let o=!1;function c(){o=!0;for(const e of["high","normal","low"])for(const t of n[e])n[e].delete(t),t();o=!1}function r(e,t="normal"){n[t].add(e),o||queueMicrotask(c)}let l=!1;const a=new Set;let s="low";function i(e,t){l?(a.add(e),"high"===t?s="high":"normal"===t&&"low"===s&&(s="normal")):r(e,t)}const u={activeEffect:null,activeDeps:null};function f(e){let t,n=!0;const o=new Set,c=new Set,r=()=>{n||(n=!0,o.forEach(e=>i(e,"normal")))};return()=>{var l;const a=u.activeEffect;if(a&&(o.add(a),null===(l=u.activeDeps)||void 0===l||l.add(o)),n){for(const e of c)e.delete(r);c.clear();const o=u.activeEffect,l=u.activeDeps;u.activeEffect=r,u.activeDeps=c,t=e(),n=!1,u.activeEffect=o,u.activeDeps=l}return t}}function d(e,t){return function(n,o="normal"){let c=!1;const r=new Set,l=()=>{if(!c){for(const e of r)e.delete(l);r.clear();try{e.activeEffect=l,e.activeDeps=r,n()}finally{e.activeEffect=null,e.activeDeps=null}}};return t(l,o),()=>{c=!0;for(const e of r)e.delete(l);r.clear()}}}const v={activeNode:null};let p=0;const w=d(u,r);const h=t("default");exports.batch=function(e){l=!0;try{e()}finally{l=!1;for(const e of a)r(e,s);a.clear(),s="low"}},exports.computed=function(e){const t={id:++p,type:"computed",label:n,deps:new Set};var n;const o=f(()=>{const n=v.activeNode;v.activeNode=t;try{return e()}finally{v.activeNode=n}});return()=>{const e=v.activeNode;return e&&e.deps.add(t),o()}},exports.createComputed=f,exports.createIntentBus=function(e){const t=new Map,n=new Map,o=e=>null!=e?e:h;return{on(e,n,c){const r=o(c),l=function(e,n){var o,c;const r=null!==(o=t.get(e))&&void 0!==o?o:new Map,l=null!==(c=r.get(n))&&void 0!==c?c:new Set;return r.set(n,l),t.set(e,r),l}(e,r);return l.add(n),()=>{var o;l.delete(n),l.size||null===(o=t.get(e))||void 0===o||o.delete(r)}},effect(e,t,c){const r=function(e,t){var o,c;const r=null!==(o=n.get(e))&&void 0!==o?o:new Map,l=null!==(c=r.get(t))&&void 0!==c?c:[];return r.set(t,l),n.set(e,r),l}(e,o(c));return r.push(t),()=>{const e=r.indexOf(t);0>e||r.splice(e,1)}},async emit(c,r,l){var a,s,i;const u=o(l),f=null===(a=t.get(c))||void 0===a?void 0:a.get(u);if(!(null==f?void 0:f.size))return;const d=e(r,u),v=(null!==(i=null===(s=n.get(c))||void 0===s?void 0:s.get(u))&&void 0!==i?i:[]).reduceRight((e,t)=>t(e),async e=>{for(const t of f)await t(e)});await v(d)},scope:h}},exports.createReactiveEffect=d,exports.createScope=t,exports.intentEffect=function(){const e=[],t=()=>t=>e.reduceRight((e,t)=>t(e),t);return t.takeLatest=()=>{let n=null;return e.push(e=>async t=>(null==n||n.abort(),n=new AbortController,e({...t,signal:n.signal}))),t},t.takeLeading=()=>{let n=!1;return e.push(e=>async t=>{if(!n){n=!0;try{return await e(t)}finally{n=!1}}}),t},t.debounce=n=>{let o;return e.push(e=>t=>new Promise(c=>{clearTimeout(o),o=setTimeout(()=>c(e(t)),n)})),t},t.throttle=n=>{let o=0;return e.push(e=>async t=>{const c=Date.now();if(c-o>=n)return o=c,e(t)}),t},t},exports.reactiveEffect=w,exports.schedule=r,exports.signal=function(e){let t=e;const n=new Set,o=()=>{const e=u.activeEffect;return e&&(n.add(e),u.activeDeps&&u.activeDeps.add(n)),t};return o.set=(e,o="normal")=>{Object.is(e,t)||(t=e,n.forEach(e=>{e!==u.activeEffect&&i(e,o)}))},o.subscribe=e=>(n.add(e),()=>{n.delete(e)}),o};
