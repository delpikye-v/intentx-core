"use strict";let e=0;function t(t){return Symbol(null!=t?t:"scope-"+ ++e)}const n={high:[],normal:[],low:[]};let o=!1;function c(){var e;o=!0;for(const t of["high","normal","low"])for(;n[t].length;)null===(e=n[t].shift())||void 0===e||e();o=!1}function r(e,t="normal"){n[t].push(e),o||queueMicrotask(c)}const l={activeNode:null,activeEffect:null};let i=0;function a(e,t){return{id:++i,type:e,label:t,deps:new Set}}let u=!1;const s=new Set;let f="low";const d=t("default");exports.batch=function(e){u=!0;try{e()}finally{u=!1,s.forEach(e=>r(e,f)),s.clear(),f="low"}},exports.createComputed=function(e){let t,n=!0;const o=new Set,c=a("computed"),i=()=>{n||(n=!0,o.forEach(e=>{return t=e,n="normal",void(u?(s.add(t),"low"===f&&(f="normal")):r(t,n));var t,n}))};return()=>{if(l.activeNode&&l.activeNode.deps.add(c),l.activeEffect&&o.add(l.activeEffect),n){const o=l.activeNode,r=l.activeEffect;l.activeNode=c,l.activeEffect=i,t=e(),n=!1,l.activeNode=o,l.activeEffect=r}return t}},exports.createIntentBus=function(e){const t=new Map,n=new Map,o=e=>null!=e?e:d;return{on(e,n,c){const r=o(c),l=function(e,n){var o,c;const r=null!==(o=t.get(e))&&void 0!==o?o:new Map,l=null!==(c=r.get(n))&&void 0!==c?c:new Set;return r.set(n,l),t.set(e,r),l}(e,r);return l.add(n),()=>{var o;l.delete(n),l.size||null===(o=t.get(e))||void 0===o||o.delete(r)}},effect(e,t,c){const r=function(e,t){var o,c;const r=null!==(o=n.get(e))&&void 0!==o?o:new Map,l=null!==(c=r.get(t))&&void 0!==c?c:[];return r.set(t,l),n.set(e,r),l}(e,o(c));return r.push(t),()=>{const e=r.indexOf(t);0>e||r.splice(e,1)}},async emit(c,r,l){var i,a,u;const s=o(l),f=null===(i=t.get(c))||void 0===i?void 0:i.get(s);if(!(null==f?void 0:f.size))return;const d=e(r,s),v=null!==(u=null===(a=n.get(c))||void 0===a?void 0:a.get(s))&&void 0!==u?u:[];for(const e of f){const t=v.reduceRight((e,t)=>t(e),e);await t(d)}},scope:d}},exports.createScope=t,exports.intentEffect=function(){const e=[],t=()=>t=>e.reduceRight((e,t)=>t(e),t);return t.takeLatest=()=>{let n=null;return e.push(e=>async t=>(null==n||n.abort(),n=new AbortController,e({...t,signal:n.signal}))),t},t.takeLeading=()=>{let n=!1;return e.push(e=>async t=>{if(!n){n=!0;try{return await e(t)}finally{n=!1}}}),t},t.debounce=n=>{let o;return e.push(e=>t=>new Promise(c=>{clearTimeout(o),o=setTimeout(()=>c(e(t)),n)})),t},t.throttle=n=>{let o=0;return e.push(e=>async t=>{const c=Date.now();if(c-o>=n)return o=c,e(t)}),t},t},exports.reactiveEffect=function(e,t="normal"){const n=a("effect","reactive");let o=!1;const c=()=>{if(!o)try{l.activeNode=n,l.activeEffect=c,e()}finally{l.activeNode=null,l.activeEffect=null}};return r(c,t),()=>{o=!0,n.deps.clear()}},exports.schedule=r;
