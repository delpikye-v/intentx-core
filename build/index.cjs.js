"use strict";let e=0;function t(t){return Symbol(null!=t?t:"scope-"+ ++e)}const n={high:[],normal:[],low:[]};let o=!1;function c(){var e;o=!0;for(const t of["high","normal","low"])for(;n[t].length;)null===(e=n[t].shift())||void 0===e||e();o=!1}function l(e,t="normal"){n[t].push(e),o||queueMicrotask(c)}const r={activeNode:null,activeEffect:null};let a=0;function i(e,t){return{id:++a,type:e,label:t,deps:new Set}}let u=!1;const s=new Set;let f="low";const d=t("default");exports.batch=function(e){u=!0;try{e()}finally{u=!1,s.forEach(e=>l(e,f)),s.clear(),f="low"}},exports.createComputed=function(e){let t,n=!0;const o=new Set,c=i("computed"),a=()=>{n||(n=!0,o.forEach(e=>{return t=e,n="normal",void(u?(s.add(t),"low"===f&&(f="normal")):l(t,n));var t,n}))};return()=>{if(r.activeNode&&r.activeNode.deps.add(c),r.activeEffect&&o.add(r.activeEffect),n){const o=r.activeNode,l=r.activeEffect;r.activeNode=c,r.activeEffect=a,t=e(),n=!1,r.activeNode=o,r.activeEffect=l}return t}},exports.createIntentBus=function(e){const t=new Map,n=new Map,o=e=>null!=e?e:d;return{on(e,n,c){var l,r;const a=o(c),i=null!==(l=t.get(e))&&void 0!==l?l:new Map,u=null!==(r=i.get(a))&&void 0!==r?r:[];u.push(n),i.set(a,u),t.set(e,i)},effect(e,t,c){var l,r;const a=o(c),i=null!==(l=n.get(e))&&void 0!==l?l:new Map,u=null!==(r=i.get(a))&&void 0!==r?r:[];u.push(t),i.set(a,u),n.set(e,i)},async emit(c,l,r){var a,i,u;const s=o(r),f=null===(a=t.get(c))||void 0===a?void 0:a.get(s);if(!(null==f?void 0:f.length))return;const d=e(l,s),v=null!==(u=null===(i=n.get(c))||void 0===i?void 0:i.get(s))&&void 0!==u?u:[];for(const e of f){const t=v.reduceRight((e,t)=>t(e),e);await t(d)}},scope:d}},exports.createScope=t,exports.intentEffect=function(e){const t=[],n=()=>e=>t.reduceRight((e,t)=>t(e),e);return n.takeLatest=()=>{let e=null;return t.push(t=>async n=>(null==e||e.abort(),e=new AbortController,t({...n,signal:e.signal}))),n},n.takeLeading=()=>{let e=!1;return t.push(t=>async n=>{if(!e){e=!0;try{return await t(n)}finally{e=!1}}}),n},n.debounce=e=>{let o;return t.push(t=>n=>new Promise(c=>{clearTimeout(o),o=setTimeout(()=>c(t(n)),e)})),n},n.throttle=e=>{let o=0;return t.push(t=>async n=>{const c=Date.now();if(c-o>=e)return o=c,t(n)}),n},n},exports.reactiveEffect=function(e,t="normal"){const n=i("effect","reactive");let o=!1;const c=()=>{if(!o)try{r.activeNode=n,r.activeEffect=c,e()}finally{r.activeNode=null,r.activeEffect=null}};return l(c,t),()=>{o=!0,n.deps.clear()}},exports.schedule=l;
