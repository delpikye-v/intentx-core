let e=0;function t(t){return Symbol(null!=t?t:"scope-"+ ++e)}const n={high:[],normal:[],low:[]};let l=!1;function o(e){var t,i,r;for(l=!0;n.high.length||n.normal.length||n.low.length;)if(n.high.length)null===(t=n.high.shift())||void 0===t||t();else if(n.normal.length)null===(i=n.normal.shift())||void 0===i||i();else if(n.low.length){if(e&&e.timeRemaining()<1)break;null===(r=n.low.shift())||void 0===r||r()}l=!1,n.low.length&&("undefined"!=typeof requestIdleCallback?requestIdleCallback(o):setTimeout(o,16))}function i(e,t="normal"){n[t].push(e),l||("high"===t?o():"undefined"!=typeof requestIdleCallback?requestIdleCallback(o):setTimeout(o,16))}const r={activeNode:null,activeEffect:null};let a=0;function c(e,t){return{id:++a,type:e,label:t,deps:new Set}}function u(e,t){e.deps.add(t)}function s(e,t="normal"){const n=c("effect","reactive");let l=!1;const o=()=>{if(!l)try{r.activeNode=n,r.activeEffect=o,e()}finally{r.activeNode=null,r.activeEffect=null}};return i(o,t),()=>{l=!0,n.deps.clear()}}function f(e){let t,n=!0;const l=new Set,o=c("computed"),a=()=>{n||(n=!0,l.forEach(e=>i(e)))};return()=>{if(r.activeNode&&u(r.activeNode,o),r.activeEffect&&l.add(r.activeEffect),n){const l=r.activeNode,i=r.activeEffect;r.activeNode=o,r.activeEffect=a,t=e(),n=!1,r.activeNode=l,r.activeEffect=i}return t}}let d=!1;const v=new Set;let h="low";function g(e){d=!0;try{e()}finally{d=!1,v.forEach(e=>i(e,h)),v.clear(),h="low"}}function w(e,t){d?(v.add(e),"high"===t?h="high":"normal"===t&&"low"===h&&(h="normal")):i(e,t)}function m(e){const t=[],n=()=>n=>function(e,t){return e.reduceRight((e,t)=>t(e),t)}(t,async t=>(await(async t=>{t.signal.aborted||await e(t)})(t),n(t))),l=e=>n()(e);return l.takeLatest=()=>{let e=null;return t.push(t=>async n=>{if(null==e||e.abort(),e=new AbortController,!e.signal.aborted)return t({...n,signal:e.signal})}),l},l.debounce=e=>{let n;return t.push(t=>l=>new Promise(o=>{clearTimeout(n),n=setTimeout(()=>{l.signal.aborted||o(t(l))},e)})),l},l.retry=(e=3)=>(t.push(t=>async n=>{let l;for(let o=0;o<=e;o++)try{return await t(n)}catch(e){if(n.signal.aborted)return;l=e}throw l}),l),l}const p=t("default");function b(e){const t=new Map,n=new Map;function l(e){return null!=e?e:p}function o(e,t,l){var o;const i=null===(o=n.get(e))||void 0===o?void 0:o.get(t);return(null==i?void 0:i.length)?i.reduceRight((e,t)=>t(e),l):l}return{on(e,n,o){var i,r;const a=l(o),c=null!==(i=t.get(e))&&void 0!==i?i:new Map,u=null!==(r=c.get(a))&&void 0!==r?r:[];return u.push(n),c.set(a,u),t.set(e,c),()=>{var e;c.set(a,(null!==(e=c.get(a))&&void 0!==e?e:[]).filter(e=>e!==n))}},effect(e,t,o){var i,r;const a=l(o),c=null!==(i=n.get(e))&&void 0!==i?i:new Map,u=null!==(r=c.get(a))&&void 0!==r?r:[];u.push(t),c.set(a,u),n.set(e,c)},async emit(n,i,r){var a;const c=l(r),u=null===(a=t.get(n))||void 0===a?void 0:a.get(c);if(!(null==u?void 0:u.length))return;const s=e(i,c);for(const e of u){if(s.signal.aborted)break;const t=o(n,c,e);await t(s)}},scope:p}}function y(e){return(t,n)=>{let l=-1;const o=i=>{var r;if(i<=l)return Promise.reject();l=i;const a=null!==(r=e[i])&&void 0!==r?r:n;return Promise.resolve(a(t,()=>o(i+1)))};return o(0)}}export{g as batch,y as compose,f as createComputed,b as createIntentBus,t as createScope,m as intentEffect,u as linkNodes,w as queueJob,r as reactiveContext,s as reactiveEffect,i as schedule,c as trackNode};
